---
name: plan-task-implementer
description: Use this skill to implement the next pending task from doc/PLAN.md. The skill reads the plan, finds the first incomplete task, asks for confirmation, reads CONCEPT.md and ARCHITECTURE.md for context, implements the task, verifies acceptance criteria by running existing or temporary test scripts, cleans up temporary scripts, marks the task as completed in PLAN.md, and provides a summary report.
version: 1.0.0
tools: [Read, Write, Edit, Glob, Grep, Bash, AskUserQuestion, Task]
---

# Plan Task Implementer

Automates task implementation from doc/PLAN.md. Finds the next incomplete task, implements it, verifies acceptance criteria, and updates the status.

## Workflow Overview

```
Step 1: Parse PLAN.md → Find next pending task
Step 2: Ask user confirmation → Proceed or skip
Step 3: Read context → CONCEPT.md + ARCHITECTURE.md
Step 4: Implement task → Write code
Step 5: Verify acceptance criteria → Run tests
Step 6: Clean up → Remove temporary test scripts
Step 7: Mark complete → Update PLAN.md
Step 8: Report → Summary of changes
```

## Step 1: Parse PLAN.md

Read `doc/PLAN.md` and find the first task that has `- [ ] **Done**` (not marked as completed).

Task structure in PLAN.md:
```markdown
## Task N: Task Title
- [ ] **Done**

**Description:**
Task description here...

**Acceptance Criteria:**
- [ ] TC-N.1: First criterion
- [ ] TC-N.2: Second criterion
```

Extract:
- Task number and title
- Description
- All acceptance criteria (TC-N.M format)

If all tasks are completed (`- [x] **Done**`), inform the user that there are no pending tasks.

## Step 2: Ask User Confirmation

Use `AskUserQuestion` to confirm implementation:

```
Found next pending task:

## Task N: [Task Title]

**Description:** [Brief description]

**Acceptance Criteria:**
- TC-N.1: [First criterion]
- TC-N.2: [Second criterion]
...

Proceed with implementation?
```

Options:
1. "Yes, implement this task" - Continue to Step 3
2. "Skip to next task" - Go back to Step 1, find next task
3. "Cancel" - Stop execution

## Step 3: Read Project Context

Read the following files for implementation context:
- `doc/CONCEPT.md` - Understand the product requirements and core rules
- `doc/ARCHITECTURE.md` - Understand technical decisions, project structure, and patterns

Also examine existing code in the `src/` directory to understand:
- Existing patterns and conventions
- Import structure
- Error handling approach
- Logging conventions

## Step 4: Implement Task

Based on the task description and acceptance criteria:

1. **Plan implementation** - Break down the task into smaller steps
2. **Create/modify files** - Write the necessary code following project conventions
3. **Follow ARCHITECTURE.md** - Match the specified project structure and patterns
4. **Use existing patterns** - Follow conventions established in existing code
5. **Add necessary imports** - Update `__init__.py` files as needed

Implementation guidelines:
- Follow Python best practices and PEP 8
- Use type hints
- Add docstrings for public functions/classes
- Handle errors appropriately
- Use async/await where specified in architecture

## Step 5: Verify Acceptance Criteria

For each acceptance criterion (TC-N.M), verify it passes:

### 5.1 Check for Existing Tests

First, look for existing test files in `tests/` directory:
```
tests/test_<module_name>.py
tests/unit/test_<module_name>.py
tests/integration/test_<module_name>.py
```

If relevant tests exist, run them:
```bash
python -m pytest tests/test_<module_name>.py -v
```

### 5.2 Write Temporary Test Scripts

If no existing tests cover a criterion, create a temporary test script:

Location: `tests/_temp_tc_N_M.py`

Script structure:
```python
"""
Temporary test for TC-N.M: [Criterion description]
Auto-generated by plan-task-implementer skill.
"""
import asyncio
import sys
sys.path.insert(0, '.')

async def test_tc_N_M():
    # Test implementation
    ...
    print("TC-N.M: PASSED")

if __name__ == "__main__":
    asyncio.run(test_tc_N_M())
```

Run the temporary test:
```bash
python tests/_temp_tc_N_M.py
```

### 5.3 Manual Verification

For criteria that require manual verification (e.g., visual inspection, external service calls):
1. Document what was checked
2. Include evidence (command output, screenshot references)
3. Ask user to confirm if needed

### 5.4 Record Results

Track which criteria passed/failed:
- PASSED: Criterion verified successfully
- FAILED: Criterion not met (stop and fix)
- SKIPPED: Cannot be automatically verified (document reason)

## Step 6: Clean Up

Delete all temporary test scripts created during verification:
```bash
rm tests/_temp_tc_*.py
```

Do NOT delete:
- Existing test files
- Permanent test files you created as part of the implementation

## Step 7: Mark Task Complete

If ALL acceptance criteria passed, update `doc/PLAN.md`:

1. Change task status:
   - From: `- [ ] **Done**`
   - To: `- [x] **Done**`

2. Mark each acceptance criterion:
   - From: `- [ ] TC-N.M: ...`
   - To: `- [x] TC-N.M: ...`

Use the `Edit` tool to make these changes.

## Step 8: Generate Report

Provide a summary report to the user:

```markdown
# Task Implementation Report

## Task N: [Task Title]

### Status: COMPLETED / PARTIALLY COMPLETED / FAILED

### Files Changed
- `path/to/file1.py` - Created: [brief description]
- `path/to/file2.py` - Modified: [brief description]

### Acceptance Criteria Results
- [x] TC-N.1: [Criterion] - PASSED
- [x] TC-N.2: [Criterion] - PASSED
- [ ] TC-N.3: [Criterion] - FAILED: [reason]

### Tests Run
- `tests/test_module.py` - 5 passed, 0 failed
- `tests/_temp_tc_N_1.py` - PASSED (deleted)

### Notes
[Any important observations or warnings]

### Next Steps
[If failed: what needs to be fixed]
[If passed: suggest running next task with /plan-task-implementer]
```

## Error Handling

### If Implementation Fails
1. Document what was attempted
2. Identify the blocking issue
3. Do NOT mark task as complete
4. Suggest fixes or ask for user input

### If Tests Fail
1. Attempt to fix the issue (up to 2 attempts)
2. If still failing, report the failure
3. Do NOT mark the criterion as passed
4. Do NOT mark task as complete

### If Cannot Verify Criterion
1. Document why verification is not possible
2. Ask user if they want to manually verify and proceed
3. Mark as SKIPPED with explanation

## Rules

- NEVER mark a task as complete if ANY acceptance criterion fails
- ALWAYS clean up temporary test files
- ALWAYS read context files before implementing
- ALWAYS ask for confirmation before starting implementation
- ALWAYS provide a detailed report at the end
- Communicate with user in their preferred language
- Use English for code, comments, and documentation
